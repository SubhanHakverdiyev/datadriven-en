
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Dudás Ákos">
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.3.0">
    
    
      
        <title>JPA & Spring Data - BMEVIAUAC01 Data-driven systems</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8b42a75e.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../extra-material-theme.css">
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="red" data-md-color-accent="red">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#jpa-spring-data" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="BMEVIAUAC01 Data-driven systems" class="md-header__button md-logo" aria-label="BMEVIAUAC01 Data-driven systems" data-md-component="logo">
      
  <img src="../../img/logo-bme-aut.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BMEVIAUAC01 Data-driven systems
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              JPA & Spring Data
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Switch to dark theme"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark theme" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent=""  aria-label="Switch to light theme"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light theme" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/bmeviauac01/datadriven-en/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    bmeviauac01/datadriven-en
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Data-driven systems
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../db/" class="md-tabs__link">
        Database
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../lecture-notes/architecture/" class="md-tabs__link">
        Lecture notes
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../transactions/" class="md-tabs__link md-tabs__link--active">
        Seminars
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../homework/" class="md-tabs__link">
        Homework
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BMEVIAUAC01 Data-driven systems" class="md-nav__button md-logo" aria-label="BMEVIAUAC01 Data-driven systems" data-md-component="logo">
      
  <img src="../../img/logo-bme-aut.png" alt="logo">

    </a>
    BMEVIAUAC01 Data-driven systems
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/bmeviauac01/datadriven-en/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    bmeviauac01/datadriven-en
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Data-driven systems
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Database
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Database" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Database
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../db/" class="md-nav__link">
        Sample database scheme
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../db/mssql/" class="md-nav__link">
        Using Microsoft SQL Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../db/mongodb/" class="md-nav__link">
        Using MongoDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://raw.githubusercontent.com/bmeviauac01/adatvezerelt/master/docs/db/mssql.sql" class="md-nav__link">
        Sample database: mssql.sql
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://raw.githubusercontent.com/bmeviauac01/adatvezerelt/master/docs/db/mongo.js" class="md-nav__link">
        Sample database: mongo.js
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Lecture notes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Lecture notes" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Lecture notes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/architecture/" class="md-nav__link">
        Data-driven systems and the three- or multi-tier architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/transactions/" class="md-nav__link">
        Transactions in databases
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/mssql/sql/" class="md-nav__link">
        SQL language, MSSQL platform-specific SQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/mssql/server-side-programming/" class="md-nav__link">
        Microsoft SQL Server programming
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/adonet/" class="md-nav__link">
        ADO.NET data access
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/linq/" class="md-nav__link">
        LINQ: Language Integrated Query
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/ef/" class="md-nav__link">
        Defining relationships in Entity Framework
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/mongodb/" class="md-nav__link">
        MongoDB basics, operations, and the MongoDB .NET Driver
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/di/" class="md-nav__link">
        Dependency Injection ASP.NET Core environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/async/" class="md-nav__link">
        Asynchronous queries and DTOs (sample WebAPI application)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/bmeviauac01/rest-webapi-sample" class="md-nav__link">
        REST and WebAPI sample app (GitHub)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/bmeviauac01/todoapi-di-sample" class="md-nav__link">
        ASP.NET Core DI sample app (GitHub)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/bmeviauac01/threelayered-aspnetcore-sample" class="md-nav__link">
        Sample three-tier webapp (GitHub)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Seminars
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Seminars" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Seminars
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../transactions/" class="md-nav__link">
        Transactions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mssql/" class="md-nav__link">
        Microsoft SQL Server programming
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ef/" class="md-nav__link">
        Entity Framework
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mongodb/" class="md-nav__link">
        MongoDB
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          JPA & Spring Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        JPA & Spring Data
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-work-during-the-seminar" class="md-nav__link">
    How to work during the seminar
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tips-for-using-the-ide" class="md-nav__link">
    Tips for using the IDE
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-0-create-a-database" class="md-nav__link">
    Exercise 0: Create a database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-1-start-the-ide" class="md-nav__link">
    Exercise 1: Start the IDE
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-2-import-project" class="md-nav__link">
    Exercise 2: Import project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-3-overview-of-the-entities" class="md-nav__link">
    Exercise 3: Overview of the entities
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-4-queries" class="md-nav__link">
    Exercise 4: Queries
  </a>
  
    <nav class="md-nav" aria-label="Exercise 4: Queries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-the-application" class="md-nav__link">
    Running the application
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-5-data-modification" class="md-nav__link">
    Exercise 5: Data modification
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-6-using-stored-procedures" class="md-nav__link">
    Exercise 6: Using stored procedures
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rest/" class="md-nav__link">
        REST API & ASP.NET Web API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Homework
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Homework" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Homework
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/" class="md-nav__link">
        Optional homework
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/mssql/" class="md-nav__link">
        Exercise: MSSQL server-side programming
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/adonet/" class="md-nav__link">
        Exercise: ADO.NET data access
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/ef/" class="md-nav__link">
        Exercise: Entity Framework
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/mongodb/" class="md-nav__link">
        Exercise: MongoDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/rest/" class="md-nav__link">
        Exercise: REST API and Web API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/GitHub/" class="md-nav__link">
        Submitting your work (GitHub)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/GitHub-Actions/" class="md-nav__link">
        Using GitHub Actions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/VisualStudio/" class="md-nav__link">
        Install Visual Studio & .NET SDK
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-work-during-the-seminar" class="md-nav__link">
    How to work during the seminar
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tips-for-using-the-ide" class="md-nav__link">
    Tips for using the IDE
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-0-create-a-database" class="md-nav__link">
    Exercise 0: Create a database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-1-start-the-ide" class="md-nav__link">
    Exercise 1: Start the IDE
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-2-import-project" class="md-nav__link">
    Exercise 2: Import project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-3-overview-of-the-entities" class="md-nav__link">
    Exercise 3: Overview of the entities
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-4-queries" class="md-nav__link">
    Exercise 4: Queries
  </a>
  
    <nav class="md-nav" aria-label="Exercise 4: Queries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-the-application" class="md-nav__link">
    Running the application
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-5-data-modification" class="md-nav__link">
    Exercise 5: Data modification
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-6-using-stored-procedures" class="md-nav__link">
    Exercise 6: Using stored procedures
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/bmeviauac01/datadriven-en/edit/master/docs/seminar/jpa/index.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="jpa-spring-data">JPA &amp; Spring Data<a class="headerlink" href="#jpa-spring-data" title="Permanent link">&para;</a></h1>
<p>To goal of this seminar is to practice working with JPA and Spring Data. Main topics of focus: working with entities, querying the database with various techniques, updating the database. The code is integrated into a skeleton web application with a UI for testing.</p>
<h2 id="pre-requisites">Pre-requisites<a class="headerlink" href="#pre-requisites" title="Permanent link">&para;</a></h2>
<p>Required tools to complete the tasks:</p>
<ul>
<li>Spring Tool Suite (an IDE based on Eclipse)</li>
<li>Microsoft SQL Server Express edition (localdb does <strong>not</strong> work here)</li>
<li>SQL Server Management Studio</li>
<li>Database initialization script: <a href="https://raw.githubusercontent.com/bmeviauac01/adatvezerelt/master/docs/db/mssql.sql">mssql.sql</a></li>
<li>Starter code: <a href="https://github.com/bmeviauac01/gyakorlat-jpa-kiindulo">https://github.com/bmeviauac01/gyakorlat-jpa-kiindulo</a></li>
</ul>
<p>Recommended to review:</p>
<ul>
<li>JPA lecture</li>
<li>EJB, Spring lecture</li>
</ul>
<h2 id="how-to-work-during-the-seminar">How to work during the seminar<a class="headerlink" href="#how-to-work-during-the-seminar" title="Permanent link">&para;</a></h2>
<p>The exercises are solved together with the instructor. A few exercises we can try to solve by ourselves and then discuss the results. The final exercise is individual work if time permits.</p>
<div class="admonition info">
<p>This guide summarizes and explains the behavior. Before looking at these provided answers, we should think first!</p>
</div>
<h2 id="tips-for-using-the-ide">Tips for using the IDE<a class="headerlink" href="#tips-for-using-the-ide" title="Permanent link">&para;</a></h2>
<ul>
<li>Search Type(class, interface, enum): Ctrl+Shift+T (instead of opening folders in Project explorer)</li>
<li>Search file: Ctrl+Shift+R</li>
<li>Fix missing imports:Ctrl+Shift+O</li>
<li>Format code: Ctrl+Shift+F</li>
<li>In Java Resources right-click a package / New Class/Interfaces will create the source in this package</li>
<li>Restore default layout of views: Window &gt; Reset perspective</li>
<li>Increase font size:<ul>
<li>Window menu / Preferences, start typing <em>font</em> to locate <em>Fonts and Colors</em></li>
<li>Select it and under <em>Basic</em> choose <em>Text Font</em> and increase the size</li>
</ul>
</li>
</ul>
<h2 id="exercise-0-create-a-database">Exercise 0: Create a database<a class="headerlink" href="#exercise-0-create-a-database" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Use <em>Microsoft SQL Server Management Studio</em> to connect to the database. We are not using <em>localdb</em> here; the address is: <code>localhost\sqlexpress</code> and use <em>SQL Server Authentication</em> with username and password <code>sa</code>.</p>
</li>
<li>
<p>Create a new database with the name <code>adatvez</code>. <strong>You should use this exact name or will have to update the Java project</strong>. To create a new database see the instructions <a href="../transactions/">in the first seminar material</a>. If a database with this name already exists, no need to re-create it.</p>
</li>
<li>
<p>Run the database initialization script on this database. If the database exists on this machine, run the script anyway to reset any changes made in the schema.</p>
</li>
</ol>
<h2 id="exercise-1-start-the-ide">Exercise 1: Start the IDE<a class="headerlink" href="#exercise-1-start-the-ide" title="Permanent link">&para;</a></h2>
<ol>
<li>Start Spring Tool Suite from here: <code>c:\Work\hatteralkalmazasok\sts-4.5.1.RELEASE\SpringToolSuite4.exe</code>.</li>
<li>It will ask for a workspace, select: <code>c:\Work\hatteralkalmazasok\workspaces\adatvez</code></li>
<li>If there is a <strong>webshop</strong> project in the Project Explorer already, delete it: right-click the project / <em>Delete</em>, and check <em>Delete project contents on disk</em></li>
</ol>
<h2 id="exercise-2-import-project">Exercise 2: Import project<a class="headerlink" href="#exercise-2-import-project" title="Permanent link">&para;</a></h2>
<ol>
<li>Download the project skeleton!<ul>
<li>Open a new <em>command prompt</em></li>
<li>Navigate to a directory, e.g. <code>c:\work\NEPTUN</code></li>
<li>Execute <code>git clone --depth 1 https://github.com/bmeviauac01/gyakorlat-jpa-kiindulo.git</code></li>
</ul>
</li>
<li>Import the downloaded project into the workspace:<ul>
<li>Open <em>File / Import...</em></li>
<li>Start typing <em>Existing Maven Projects</em> and choose it</li>
<li>Locate the downloaded webshop project (the <code>webshop</code> folder in the checked-out repository), OK, check the webshop project in the dialog</li>
<li>Finish</li>
</ul>
</li>
<li>Overview of the projects<ul>
<li>It is a <em>maven</em> based project. Maven is a command-line build tool that can be integrated with IDEs as well. It can download the libraries our projects depend on from public repositories. After opening the <code>pom.xml</code> file, the maven project's config file, you can see some dependency tags that will transitively download Hibernate, our JPA implementation, Spring Boot, Spring Data, Spring MVC and Thymeleaf.</li>
<li>The application.properties file contains some basic settings. <strong>Let us verify the database name (spring.datasource.url), the user name (spring.datasource.username) and password (spring.datasource.password) for the DB access here.</strong> In classic Java EE web applications, this JNDI name of the database should be defined in the <code>persistence.xml</code>, but Spring Boot supports XML-less configuration.</li>
<li><code>WebshopApplication</code> is the entry point and configuration of the Spring Boot application. A traditional web application should be deployed to a web container (e.g., Tomcat, Jetty) running in a separate process. In the case of Spring Boot, however, Spring Boot itself will start an embedded web container (Tomcat, by default).</li>
<li>The web interface is one page: <code>src\main\resources\templates\testPage.html</code>. We will not modify it. It contains standard HTML and some Thymeleaf attributes.</li>
<li><code>WebshopController</code>: the controller class implementing the web layer (its methods handle the HTTP requests). These methods typically call a query implemented in a repository or a service method and put the result into the model with a name that we can reference via Thymeleaf. You should call the methods implementing the tasks at the <code>//TODO</code> comments.</li>
</ul>
</li>
</ol>
<h2 id="exercise-3-overview-of-the-entities">Exercise 3: Overview of the entities<a class="headerlink" href="#exercise-3-overview-of-the-entities" title="Permanent link">&para;</a></h2>
<ul>
<li>The  entities can be found in the <code>hu.bme.aut.adatvez.webshop.model</code> package. We could have written them by hand, but in this case, they were generated from the DB tables via the JPA plugin of Eclipse.</li>
<li>Open an entity class, e.g., Vat, and check the JPA-related code. You can see the <code>@Entity</code>, <code>@Id</code> annotations, and <code>@OneToMany</code> or <code>@ManyToOne</code> for defining relationships.</li>
</ul>
<h2 id="exercise-4-queries">Exercise 4: Queries<a class="headerlink" href="#exercise-4-queries" title="Permanent link">&para;</a></h2>
<p>Implement the following queries on the data model. In JPA and Spring Data, you can write queries by different means. In the following tasks, we specify how to write the query so that multiple ways can be demonstrated.</p>
<div class="admonition important">
<p>It is important to note that each task could be written using any technology and style. The requirements are provided for demonstrating all technologies.</p>
</div>
<p>The methods implementing the queries should always be called in the <code>WebshopController</code> class, at the corresponding <code>//TODO</code> comment, run the application and test the query from a browser at address <a href="http://localhost:9080">http://localhost:9080</a>.</p>
<p><strong>a)</strong> List the names and stock of those products of which we have more than 30 pieces in stock! Method: Spring Data repository interface with method name-derived query.</p>
<p><strong>b)</strong> Write a query that lists those products that were ordered at least twice! Method: JPQL query created with an injected EntityManager in a Spring Data custom repository implementation.</p>
<p><strong>c)</strong> List the data of the most expensive product! Method: Named query, called from Spring Data repository or with an injected EntityManager.</p>
<p>When running the application, the SQL statements generated by Hibernate can be observed in the Console view of Eclipse, due to this config line in application.properties: <code>spring.jpa.show-sql=true</code></p>
<h3 id="running-the-application">Running the application<a class="headerlink" href="#running-the-application" title="Permanent link">&para;</a></h3>
<p>Right-click on the <em>webshop</em> project in the Project Explorer &gt; Debug As &gt; Spring Boot App. This starts the application in debug mode, which starts an embedded web container, and the application is available at <a href="http://localhost:9080">http://localhost:9080</a> from a browser. Having done this once, we can do it more easily: Click on the Debug icon on the toolbar, and you will see the webshop run there.</p>
<p><img alt="Eclipse run" src="images/eclipse-run.png" /></p>
<p>If under the <em>Debug</em> icon you find <em>webshop run</em>, the method above is unnecessary.</p>
<p>The running application can be stopped with the red <em>Terminate</em> icon in the Console view. If we run the application twice, without terminating the first run, the second run will report a port collision on the port 9080 and stop. This second execution will be visible in the <em>Console</em> view, and the <em>Terminate</em> command will be inactive, as this copy has been terminated already. Click on the gray double C icon next to <em>Terminate</em> to close this view, and only the active running process will be visible.</p>
<p>If we close the <em>Console</em> view by mistake, use shortcut <em>Alt+Shift+Q, C</em> or menu <em>Window / Show View / Console</em> to reopen.</p>
<p>After shutdown, we can re-run using F11.</p>
<p>When running the application in debug mode, the modifications in HTML files and some Java ode modifications are immediately actualized, so we only have to refresh the browser to see the effect of the code modification. But the application has to be restarted if we modify the Java code in either of the following ways</p>
<ul>
<li>adding a new type</li>
<li>adding/removing/modifying an annotation</li>
<li>adding a new class-or member variable, or method</li>
<li>we changed the signature of a method.</li>
</ul>
<p>Simply put, when modifying code that is not inside of an existing method, a restart will be needed.</p>
<details class="example"><summary>Solution</summary><p><strong>4.a exercise</strong></p>
<p>In the <code>dao</code> package open <code>ProductRepository</code> interface that implements the Spring Data <code>JpaRepository</code>. There are a few methods for other exercises. Some define a <code>@Query</code> annotation and the query as text, some work without such annotation. We will not need the <code>@Query</code> annotation, but rather have Spring Data infer the SQL instruction from the method name as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">hu.bme.aut.adatvez.webshop.dao</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">hu.bme.aut.adatvez.webshop.model.Product</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductRepository</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Product</span><span class="p">,</span> <span class="n">Long</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">ProductRepositoryCustom</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">findByStockGreaterThan</span><span class="p">(</span><span class="n">BigDecimal</span> <span class="n">limit</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p><code>WebshopController</code> already contains an injected <code>ProductRepository</code>; let us call this method at TODO 4.a:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebshopController</span> <span class="p">{</span>

  <span class="nd">@Autowired</span>
  <span class="n">ProductRepository</span> <span class="n">productRepository</span><span class="p">;</span>

  <span class="c1">//...</span>
  <span class="c1">// 4.a</span>
  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">findProductsOver30</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">productRepository</span><span class="p">.</span><span class="na">findByStockGreaterThan</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">30</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>4.b exercise</strong></p>
<p>In the <code>dao</code> package find <code>ProductRepositoryCustom</code> interface add a new method <code>findProductsOrderedAtLeastTwice</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">hu.bme.aut.adatvez.webshop.dao</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">hu.bme.aut.adatvez.webshop.model.Product</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductRepositoryCustom</span> <span class="p">{</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">findProductsOrderedAtLeastTwice</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>The implementation class <code>ProductRepositoryImpl</code> will contain an error now as it does not implement <code>ProductRepositoryCustom</code>. Let us open this class, and line of the class declaration there will be a light bulb we can click to generate the method skeleton:</p>
<p><img alt="Eclise implement interface" src="images/eclipse-implement-methods.png" /></p>
<p>Add the method's implementation as follows: use the injected EntityManager to create and run the query.</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">hu.bme.aut.adatvez.webshop.dao</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">hu.bme.aut.adatvez.webshop.model.Product</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductRepositoryImpl</span> <span class="kd">implements</span> <span class="n">ProductRepositoryCustom</span> <span class="p">{</span>

  <span class="nd">@PersistenceContext</span>
  <span class="n">EntityManager</span> <span class="n">em</span><span class="p">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">findProductsOrderedAtLeastTwice</span><span class="p">(){</span>
    <span class="k">return</span> <span class="n">em</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">&quot;SELECT DISTINCT p FROM Product p</span>
<span class="s">                          LEFT JOIN FETCH p.orderitems</span>
<span class="s">                          WHERE size(p.orderitems) &gt;= :itemsMin&quot;</span><span class="p">,</span> <span class="n">Product</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
          <span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="s">&quot;itemsMin&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
          <span class="p">.</span><span class="na">getResultList</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Note: we might try this command: <code>SELECT p FROM Product p WHERE size(p.orderitems) /= :itemsMin</code>, which will yield an <code>org.hibernate.LazyInitializationException</code> error, hence the <code>LEFT JOIN FETCH</code> above.</p>
<p>Call this in <code>WebshopController</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 4.b</span>
<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">findProductsOrderedAtLeastTwice</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// TODO</span>
  <span class="k">return</span> <span class="n">productRepository</span><span class="p">.</span><span class="na">findProductsOrderedAtLeastTwice</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>4.c exercise</strong></p>
<p>Open entity class <code>Product</code> where we can find a few named querys; we need the second one:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@NamedQueries</span><span class="p">({</span>
<span class="nd">@NamedQuery</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Product.findAll&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s">&quot;SELECT p FROM Product p&quot;</span><span class="p">),</span>
<span class="nd">@NamedQuery</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Product.findMostExpensive&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s">&quot;SELECT p FROM Product p WHERE p.price IN (SELECT MAX(p2.price) FROM Product p2)&quot;</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div>
<p>This named query can be called in two ways. The first is to create a method in <code>ProductRepository</code> with the same name (without the <em>Product.</em> prefix.), that is:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">findMostExpensive</span><span class="p">();</span>
</code></pre></div>
<p>The second option is to execute it manually in <code>ProductRepositoryImpl</code> using <code>EntityManager</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">findMostExpensiveProducts</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">em</span><span class="p">.</span><span class="na">createNamedQuery</span><span class="p">(</span><span class="s">&quot;Product.findMostExpensive&quot;</span><span class="p">,</span> <span class="n">Product</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">getResultList</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>This method also needs to be added to the <code>ProductRepositoryCustom</code> interface. E.g. right-click / <em>Refactor / Pull up</em></p>
<p>Finally, call the method in <code>WebshopController</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 4.c</span>
<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">findMostExpensiveProducts</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// TODO</span>
  <span class="c1">// return productRepository.findMostExpensiveProducts();</span>
  <span class="k">return</span> <span class="n">productRepository</span><span class="p">.</span><span class="na">findMostExpensive</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</details>
<h2 id="exercise-5-data-modification">Exercise 5: Data modification<a class="headerlink" href="#exercise-5-data-modification" title="Permanent link">&para;</a></h2>
<p>JPA can also be used to modify the database content.</p>
<p><strong>a)</strong> Write a JPQL query into the <code>ProductRepository</code> interface that raises the price of "Building items" by 10 percent!</p>
<p><strong>b)</strong> Write a method that creates a new category called "Expensive toys", if it does not exist yet, and move all the products with a price higher than 8000 into this category!</p>
<p><strong>c)</strong> Simple individual task: create a <code>CategoryRepository</code> interface, and implement a method name-derived query that you can use in task 5.b) instead of the query created with the injected EntityManager.</p>
<details class="example"><summary>Solution</summary><p><strong>5.a exercise</strong></p>
<p>Crate an <em>UPDATE query</em> in <code>ProductRepository</code> interface. We have to denote that this is a <code>@Modifying</code> query, and also add @Transactional<code>(from package</code>org.springframework...`):</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Modifying</span>
<span class="nd">@Transactional</span>
<span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;UPDATE Product p SET p.price=p.price*1.1 WHERE p.id IN</span>
<span class="s">(SELECT p2.id FROM Product p2 WHERE p2.category.name=:categoryName)&quot;</span><span class="p">)</span>
<span class="kt">void</span> <span class="nf">categoryRaisePrice</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;categoryName&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">categoryName</span><span class="p">);</span>
</code></pre></div>
<p>Call in <code>WebshopController</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 5.a</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;/raisePriceOfBuildingItems&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">,</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span> <span class="p">})</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">raisePriceOfBuildingItems</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// TODO</span>
  <span class="n">productRepository</span><span class="p">.</span><span class="na">categoryRaisePrice</span><span class="p">(</span><span class="s">&quot;Building items&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="s">&quot;redirect:/&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>In the browser, the changes are visible after clicking the button.</p>
<p><strong>5.b exercise</strong></p>
<p>In the <code>dao</code> package add a new class <code>CategoryService</code> with a <code>@Service</code> annotation with a <code>@Transactional</code> method:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CategoryService</span> <span class="p">{</span>

  <span class="nd">@PersistenceContext</span>
  <span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">em</span><span class="p">;</span>

  <span class="nd">@Autowired</span>
  <span class="n">ProductRepository</span> <span class="n">productRepository</span><span class="p">;</span>

  <span class="nd">@Transactional</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">moveToExpensiveToys</span><span class="p">(</span><span class="kt">double</span> <span class="n">priceLimit</span><span class="p">){</span>
    <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Expensive toys&quot;</span><span class="p">;</span>
    <span class="n">Category</span> <span class="n">categoryExpensive</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">resultList</span> <span class="o">=</span>
      <span class="n">em</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">&quot;SELECT c from Category c WHERE c.name=:name&quot;</span><span class="p">,</span> <span class="n">Category</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
        <span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="p">.</span><span class="na">getResultList</span><span class="p">();</span>

    <span class="k">if</span><span class="p">(</span><span class="n">resultList</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">()){</span>
      <span class="c1">// 0 or null id triggers @GeneratedValue; this is a scalar, hence use 0</span>
      <span class="n">categoryExpensive</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Category</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
      <span class="n">em</span><span class="p">.</span><span class="na">persist</span><span class="p">(</span><span class="n">categoryExpensive</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="n">categoryExpensive</span> <span class="o">=</span> <span class="n">resultList</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">expensiveProducts</span> <span class="o">=</span> <span class="n">productRepository</span><span class="p">.</span><span class="na">findByPriceGreaterThan</span><span class="p">(</span><span class="n">priceLimit</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">Product</span> <span class="n">product</span> <span class="p">:</span> <span class="n">expensiveProducts</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">categoryExpensive</span><span class="p">.</span><span class="na">addProduct</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Let us note that the managed entities (fetched through queries within the transaction, or added as new with persist) need no explicit save; the transaction saves them to DB automatically.</p>
<p>Call in <code>WebshopController</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Autowired</span>
<span class="n">CategoryService</span> <span class="n">categoryService</span><span class="p">;</span>
<span class="p">...</span>

<span class="c1">// 5.b</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;/moveToExpensiveToys&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">,</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span> <span class="p">})</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">moveToExpensiveToys</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// TODO</span>
  <span class="n">categoryService</span><span class="p">.</span><span class="na">moveToExpensiveToys</span><span class="p">(</span><span class="mf">8000.0</span><span class="p">);</span>
  <span class="k">return</span> <span class="s">&quot;redirect:/&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>In the browser, the changes are visible after clicking the button.</p>
<p><strong>5.c exercise</strong></p>
<p>In <code>dao</code> package add a new interface <code>CategoryRepository</code>, similar to <code>ProductRepository</code> (without the Custom inheritance) with one method:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CategoryRepository</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Category</span><span class="p">,</span> <span class="n">Long</span><span class="o">&gt;</span><span class="p">{</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="nf">findByName</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>This simplifies the <code>CategoryService</code> as follows:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CategoryService</span> <span class="p">{</span>
<span class="p">...</span>

  <span class="nd">@Autowired</span>
  <span class="n">CategoryRepository</span> <span class="n">categoryRepository</span><span class="p">;</span>

  <span class="nd">@Transactional</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">moveToExpensiveToys</span><span class="p">(</span><span class="kt">double</span> <span class="n">priceLimit</span><span class="p">){</span>
    <span class="c1">// ...</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">resultList</span> <span class="o">=</span> <span class="n">categoryRepository</span><span class="p">.</span><span class="na">findByName</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
    <span class="c1">//  ...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</details>
<h2 id="exercise-6-using-stored-procedures">Exercise 6: Using stored procedures<a class="headerlink" href="#exercise-6-using-stored-procedures" title="Permanent link">&para;</a></h2>
<p>Use the <code>CreatePaymentMethod</code> stored procedure to create a new <code>Paymentmethod</code>!</p>
<ul>
<li>
<p>Check in SQL Server Management Studio, whether the database contains the stored procedure with the name <code>CreatePaymentMethod</code>!</p>
</li>
<li>
<p>If not, create the procedure with the code below!</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">CreateNewPaymentMethod</span>
<span class="p">(</span>
<span class="o">@</span><span class="k">Method</span> <span class="n">nvarchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="o">@</span><span class="n">Deadline</span> <span class="nb">int</span>
<span class="p">)</span>
<span class="k">AS</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">PaymentMethod</span>
<span class="k">values</span><span class="p">(</span><span class="o">@</span><span class="k">Method</span><span class="p">,</span><span class="o">@</span><span class="n">Deadline</span><span class="p">)</span>
<span class="k">select</span> <span class="n">scope_identity</span><span class="p">()</span> <span class="k">as</span> <span class="n">NewId</span>
</code></pre></div>
</li>
</ul>
<details class="example"><summary>Solution</summary><p>The <code>PaymentMethod</code> entity has the following annotation. Compare it to the stored procedure code!</p>
<div class="highlight"><pre><span></span><code><span class="nd">@NamedStoredProcedureQueries</span><span class="p">({</span>
  <span class="nd">@NamedStoredProcedureQuery</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;createMethodSP&quot;</span><span class="p">,</span>
      <span class="n">procedureName</span> <span class="o">=</span> <span class="s">&quot;CreateNewPaymentMethod&quot;</span><span class="p">,</span>
      <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nd">@StoredProcedureParameter</span><span class="p">(</span><span class="n">mode</span> <span class="o">=</span> <span class="n">ParameterMode</span><span class="p">.</span><span class="na">IN</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Method&quot;</span><span class="p">,</span> <span class="n">type</span> <span class="o">=</span> <span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">),</span>
            <span class="nd">@StoredProcedureParameter</span><span class="p">(</span><span class="n">mode</span> <span class="o">=</span> <span class="n">ParameterMode</span><span class="p">.</span><span class="na">IN</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Deadline&quot;</span><span class="p">,</span> <span class="n">type</span> <span class="o">=</span> <span class="n">BigDecimal</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
          <span class="p">})</span>
<span class="p">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Paymentmethod</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
<span class="p">...</span>
</code></pre></div>
<p>The named stored procedure query can be called from a Spring Data repository (<code>dao</code> package <em>New Interface ... / PaymentmethodRepository</em>):</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PaymentmethodRepository</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Paymentmethod</span><span class="p">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="p">{</span>

  <span class="nd">@Procedure</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;createMethodSP&quot;</span><span class="p">)</span>
  <span class="kt">void</span> <span class="nf">newMethod</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;Method&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">method</span><span class="p">,</span> <span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;Deadline&quot;</span><span class="p">)</span> <span class="n">BigDecimal</span> <span class="n">deadline</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Without Spring Data we could use <code>EntityManager</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentmethodService</span> <span class="p">{</span>

  <span class="nd">@PersistenceContext</span>
  <span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">em</span><span class="p">;</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createNewMethod</span><span class="p">(</span><span class="n">Paymentmethod</span> <span class="n">paymentMethod</span><span class="p">){</span>
    <span class="n">StoredProcedureQuery</span> <span class="n">sp</span> <span class="o">=</span> <span class="n">em</span><span class="p">.</span><span class="na">createNamedStoredProcedureQuery</span><span class="p">(</span><span class="s">&quot;createMethodSP&quot;</span><span class="p">);</span>
    <span class="n">sp</span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="s">&quot;Method&quot;</span><span class="p">,</span> <span class="n">paymentMethod</span><span class="p">.</span><span class="na">getMethod</span><span class="p">());</span>
    <span class="n">sp</span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="s">&quot;Deadline&quot;</span><span class="p">,</span> <span class="n">paymentMethod</span><span class="p">.</span><span class="na">getDeadline</span><span class="p">());</span>
    <span class="n">sp</span><span class="p">.</span><span class="na">execute</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Call from the web layer:</p>
<ul>
<li>
<p>Inject into <code>WebshopController</code> the <code>PaymentmethodRepository</code> interface:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Autowired</span>
<span class="n">PaymentmethodRepository</span> <span class="n">paymentmethodRepository</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>Call the method from WebshopController at the last TODO</p>
<div class="highlight"><pre><span></span><code><span class="n">paymentmethodRepository</span><span class="p">.</span><span class="na">newMethod</span><span class="p">(</span><span class="n">paymentMethod</span><span class="p">.</span><span class="na">getMethod</span><span class="p">(),</span> <span class="n">paymentMethod</span><span class="p">.</span><span class="na">getDeadline</span><span class="p">());</span>
</code></pre></div>
</li>
</ul>
</details>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../mongodb/" class="md-footer__link md-footer__link--prev" aria-label="Previous: MongoDB" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              MongoDB
            </div>
          </div>
        </a>
      
      
        
        <a href="../rest/" class="md-footer__link md-footer__link--next" aria-label="Next: REST API &amp; ASP.NET Web API" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              REST API & ASP.NET Web API
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; BME VIK AUT
          </div>
        
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.top", "search.suggest"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.f8263e09.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.4fc53ad4.min.js"></script>
      
    
  </body>
</html>